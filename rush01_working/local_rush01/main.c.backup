#include <stdio.h>
#include <unistd.h>

#define SIZE 4

int grid[4][4] = { {0} };

//int column_up[] = {2, 4, 2, 1};
//int column_down[] = {2, 1, 3, 3};
//int row_left[] = {3, 3, 1, 2};
//int row_right[] = {1, 2, 4, 2};

int column_up[] = {1, 2, 2, 2};
int column_down[] = {4, 3, 2, 1};
int row_left[] = {1, 2, 3, 4};
int row_right[] = {2, 2, 2, 1};

void    ft_putchar(char a)
{
    write(1,&a,1);
}


int	check_col_up(int row, int col)
{
	int	i;
	int	count_view;
	int	tallest;

	i = -1;
	while (++i < row)
		if (grid[i][col] == grid[row][col])
			return (0);
	i = -1;
	tallest = 0;
	count_view = 0;
	while (++i <= row)
	{
		if (grid[i][col] > tallest)
		{
			tallest = grid[i][col];
			count_view++;
		}
	}
	if ((row == SIZE - 1 && column_up[col] == count_view)
		|| (row != SIZE - 1 && column_up[col] >= count_view))
		return (1);
	return (0);
}

int	check_col_down(int row, int col)
{
	int	i;
	int	count_view;
	int	tallest;

	if (row != SIZE - 1)
		return (1);
	i = row + 1;
	tallest = 0;
	count_view = 0;
	while (--i >= 0)
	{
		if (grid[i][col] > tallest)
		{
			tallest = grid[i][col];
			count_view++;
		}
	}
	if (column_down[col] == count_view)
		return (1);
	return (0);
}

int	check_row_left(int row, int col)
{
	int	i;
	int	count_view;
	int	tallest;

	i = -1;
	while (++i < col)
		if (grid[row][i] == grid[row][col])
			return (0);
	i = -1;
	tallest = 0;
	count_view = 0;
	while (++i <= col)
	{
		if (grid[row][i] > tallest)
		{
			tallest = grid[row][i];
			count_view++;
		}
	}
	if ((col == SIZE - 1 && row_left[row] == count_view)
		|| (col != SIZE - 1 && row_left[row] >= count_view))
		return (1);
	return (0);
}

int	check_row_right(int row, int col)
{
	int	i;
	int	count_view;
	int	tallest;

	if (col != SIZE - 1)
		return (1);
	i = SIZE;
	tallest = -1;
	count_view = 0;
	while (--i >= 0)
	{
		if (grid[row][i] > tallest)
		{
			tallest = grid[row][i];
			count_view++;
		}
	}
	if (row_right[row] == count_view)
		return (1);
	return (0);
}


int	ft_is_valid(int row, int column)
{
	if (
      !check_col_up(row, column) || 
		!check_col_down(row, column) ||
		!check_row_left(row, column) ||
		!check_row_right(row, column)
	)
		return (0);
	return (1);
}



// Function to check if a number is safe to place in a cell
int isSafe(int row, int col, int num) {
    // Check if the number is not present in the same row or column
    int i = 0;
    while (i < SIZE) {
        if (grid[row][i] == num || grid[i][col] == num) {
            return 0;
        }
        i++;
    }
    return 1;
}

// Function to solve the Skyscraper puzzle
int solvePuzzle(int row, int col) {
    if (row == SIZE) {
        // If we have reached the end of the grid, the puzzle is solved
        return 1;
    }

    if (grid[row][col] != 0) {
        // If the current cell is not empty, move to the next cell
        int nextRow = row, nextCol = col + 1;
        if (nextCol == SIZE) {
            nextRow++;
            nextCol = 0;
        }
        return solvePuzzle(nextRow, nextCol);
    }

    // Try placing numbers from 1 to SIZE in the current cell
    int num;
    for (num = 1; num <= SIZE; num++) {
        if (isSafe(row, col, num)) {
            grid[row][col] = num;

            // Check visibility constraints from the top, bottom, left, and right
            if (ft_is_valid(row, col)) {
                int nextRow = row, nextCol = col + 1;
                if (nextCol == SIZE) {
                    nextRow++;
                    nextCol = 0;
                }
                if (solvePuzzle(nextRow, nextCol)) {
                    return 1;
                }
            }

            // If we reach this point, the placement is invalid, so backtrack
            grid[row][col] = 0;
        }
    }

    // If no number can be placed in the current cell, backtrack
    return 0;
}


// Function to print the solved puzzle
void printPuzzle() {
    int row = 0, col = 0;
    while (row < SIZE) {
        printf("%d ", grid[row][col]);
        if (col == SIZE - 1) {
            printf("\n");
            row++;
            col = 0;
        } else {
            col++;
        }
    }
}

void ft_printgrid(int grid[4][4])
{
   int i = 0;
    int j;

    while (i < 4)
    {
        j = 0;
        while (j < 4)
        {
            ft_putchar(grid[i][j] + '0'); // Convert integer to character
            ft_putchar(' ');
            j++;
        }
        ft_putchar('\n');
        i++;
    }
}




int main() {


    if (solvePuzzle(0, 0)) {
        printf("Solution:\n");
      //  printPuzzle();
        ft_printgrid(grid);
    } else {
        printf("No solution exists.\n");
    }

    return 0;
}
